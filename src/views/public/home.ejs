<%- include('../partials/header', { title: title }) %>

<div class="max-w-2xl mx-auto bg-white rounded-lg shadow-xl p-10">
    <h1 class="text-4xl font-bold text-gray-800 mb-8">Dapatkan API Key Anda</h1>
    
    <% 
      let errorMessage = null;
      let successMessage = typeof message !== 'undefined' ? message : null;

      if (successMessage && successMessage.startsWith('Error:')) {
          errorMessage = successMessage.substring(7);
          successMessage = null;
      }
    %>

    <%- include('../partials/message', { 
        message: successMessage, 
        error: errorMessage
    }) %>

    <form id="userForm" action="/save" method="POST">
        <div class="space-y-6">
            
            <div>
                <label for="firstname" class="block text-lg font-semibold text-gray-700 mb-2">First Name</label>
                <input type="text" id="firstname" name="firstname" required
                        class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-lg p-3 border">
            </div>

            <div>
                <label for="lastname" class="block text-lg font-semibold text-gray-700 mb-2">Last Name</label>
                <input type="text" id="lastname" name="lastname" required
                        class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-lg p-3 border">
            </div>

            <div>
                <label for="email" class="block text-lg font-semibold text-gray-700 mb-2">Email</label>
                <input type="email" id="email" name="email" required
                        class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-lg p-3 border">
            </div>
            
            <hr class="my-8 border-t-2">

            <div>
                <label for="api_key" class="block text-lg font-semibold text-gray-700 mb-2">API Key</label>
                <div class="flex mt-1 space-x-3">
                    <input type="text" id="api_key" name="api_key" readonly required
                            class="block w-full rounded-md border-gray-300 shadow-sm bg-gray-50 text-lg p-3 border font-mono text-gray-600">
                    <button type="button" id="generateBtn"
                            class="whitespace-nowrap rounded-md bg-indigo-600 px-6 py-3 text-lg font-semibold text-white shadow-sm hover:bg-indigo-700 transition-colors">
                        Generate
                    </button>
                </div>
            </div>

            <button type="submit" id="saveBtn" disabled
                    class="w-full rounded-md bg-green-600 px-6 py-4 text-xl font-bold text-white shadow-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all mt-4">
                Simpan Data
            </button>
        </div>
    </form>
</div>

<script>
    document.getElementById('generateBtn').addEventListener('click', function() {
        var randomKey = Array.from(window.crypto.getRandomValues(new Uint8Array(16)))
            .map(b => b.toString(16).padStart(2, '0'))
            .join('');
        
        document.getElementById('api_key').value = randomKey;
        document.getElementById('saveBtn').disabled = false;
    });
</script>

<%- include('../partials/footer') %>